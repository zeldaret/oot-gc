# CARDBlock.c
.include "macros.inc"

.section .text, "ax"

.balign 4

glabel __CARDGetFatBlock
/* 0B7F98 800BD538 80630088 */  lwz     r3, 0x88(r3)
/* 0B7F9C 800BD53C 4E800020 */  blr     

WriteCallback:
/* 0B7FA0 800BD540 7C0802A6 */  mflr    r0
/* 0B7FA4 800BD544 90010004 */  stw     r0, 4(r1)
/* 0B7FA8 800BD548 9421FFE0 */  stwu    r1, -0x20(r1)
/* 0B7FAC 800BD54C 93E1001C */  stw     r31, 0x1c(r1)
/* 0B7FB0 800BD550 93C10018 */  stw     r30, 0x18(r1)
/* 0B7FB4 800BD554 7C9E2379 */  or.     r30, r4, r4
/* 0B7FB8 800BD558 93A10014 */  stw     r29, 0x14(r1)
/* 0B7FBC 800BD55C 3BA30000 */  addi    r29, r3, 0
/* 0B7FC0 800BD560 1CBD0110 */  mulli   r5, r29, 0x110
/* 0B7FC4 800BD564 3C608013 */  lis     r3, __CARDBlock@ha
/* 0B7FC8 800BD568 380327D0 */  addi    r0, r3, __CARDBlock@l
/* 0B7FCC 800BD56C 7FE02A14 */  add     r31, r0, r5
/* 0B7FD0 800BD570 41800048 */  blt     lbl_800BD5B8
/* 0B7FD4 800BD574 807F0080 */  lwz     r3, 0x80(r31)
/* 0B7FD8 800BD578 801F0088 */  lwz     r0, 0x88(r31)
/* 0B7FDC 800BD57C 38836000 */  addi    r4, r3, 0x6000
/* 0B7FE0 800BD580 7C002040 */  cmplw   r0, r4
/* 0B7FE4 800BD584 3CA30001 */  addis   r5, r3, 1
/* 0B7FE8 800BD588 38A58000 */  addi    r5, r5, -32768
/* 0B7FEC 800BD58C 40820018 */  bne     lbl_800BD5A4
/* 0B7FF0 800BD590 90BF0088 */  stw     r5, 0x88(r31)
/* 0B7FF4 800BD594 38650000 */  addi    r3, r5, 0
/* 0B7FF8 800BD598 38A02000 */  li      r5, 0x2000
/* 0B7FFC 800BD59C 4BF47F29 */  bl      memcpy
/* 0B8000 800BD5A0 48000018 */  b       lbl_800BD5B8
lbl_800BD5A4:
/* 0B8004 800BD5A4 909F0088 */  stw     r4, 0x88(r31)
/* 0B8008 800BD5A8 38640000 */  addi    r3, r4, 0
/* 0B800C 800BD5AC 38850000 */  addi    r4, r5, 0
/* 0B8010 800BD5B0 38A02000 */  li      r5, 0x2000
/* 0B8014 800BD5B4 4BF47F11 */  bl      memcpy
lbl_800BD5B8:
/* 0B8018 800BD5B8 801F00D0 */  lwz     r0, 0xd0(r31)
/* 0B801C 800BD5BC 28000000 */  cmplwi  r0, 0
/* 0B8020 800BD5C0 40820010 */  bne     lbl_800BD5D0
/* 0B8024 800BD5C4 387F0000 */  addi    r3, r31, 0
/* 0B8028 800BD5C8 389E0000 */  addi    r4, r30, 0
/* 0B802C 800BD5CC 4BFFE7A9 */  bl      __CARDPutControlBlock
lbl_800BD5D0:
/* 0B8030 800BD5D0 801F00D8 */  lwz     r0, 0xd8(r31)
/* 0B8034 800BD5D4 28000000 */  cmplwi  r0, 0
/* 0B8038 800BD5D8 7C0C0378 */  mr      r12, r0
/* 0B803C 800BD5DC 4182001C */  beq     lbl_800BD5F8
/* 0B8040 800BD5E0 38000000 */  li      r0, 0
/* 0B8044 800BD5E4 7D8803A6 */  mtlr    r12
/* 0B8048 800BD5E8 901F00D8 */  stw     r0, 0xd8(r31)
/* 0B804C 800BD5EC 387D0000 */  addi    r3, r29, 0
/* 0B8050 800BD5F0 389E0000 */  addi    r4, r30, 0
/* 0B8054 800BD5F4 4E800021 */  blrl    
lbl_800BD5F8:
/* 0B8058 800BD5F8 80010024 */  lwz     r0, 0x24(r1)
/* 0B805C 800BD5FC 83E1001C */  lwz     r31, 0x1c(r1)
/* 0B8060 800BD600 83C10018 */  lwz     r30, 0x18(r1)
/* 0B8064 800BD604 83A10014 */  lwz     r29, 0x14(r1)
/* 0B8068 800BD608 38210020 */  addi    r1, r1, 0x20
/* 0B806C 800BD60C 7C0803A6 */  mtlr    r0
/* 0B8070 800BD610 4E800020 */  blr     

EraseCallback:
/* 0B8074 800BD614 7C0802A6 */  mflr    r0
/* 0B8078 800BD618 90010004 */  stw     r0, 4(r1)
/* 0B807C 800BD61C 9421FFD8 */  stwu    r1, -0x28(r1)
/* 0B8080 800BD620 93E10024 */  stw     r31, 0x24(r1)
/* 0B8084 800BD624 3BE30000 */  addi    r31, r3, 0
/* 0B8088 800BD628 3C608013 */  lis     r3, __CARDBlock@ha
/* 0B808C 800BD62C 93C10020 */  stw     r30, 0x20(r1)
/* 0B8090 800BD630 1CBF0110 */  mulli   r5, r31, 0x110
/* 0B8094 800BD634 93A1001C */  stw     r29, 0x1c(r1)
/* 0B8098 800BD638 380327D0 */  addi    r0, r3, __CARDBlock@l
/* 0B809C 800BD63C 7C9D2379 */  or.     r29, r4, r4
/* 0B80A0 800BD640 7FC02A14 */  add     r30, r0, r5
/* 0B80A4 800BD644 4180003C */  blt     lbl_800BD680
/* 0B80A8 800BD648 80BE0088 */  lwz     r5, 0x88(r30)
/* 0B80AC 800BD64C 3C60800C */  lis     r3, WriteCallback@ha
/* 0B80B0 800BD650 801E0080 */  lwz     r0, 0x80(r30)
/* 0B80B4 800BD654 38E3D540 */  addi    r7, r3, WriteCallback@l
/* 0B80B8 800BD658 807E000C */  lwz     r3, 0xc(r30)
/* 0B80BC 800BD65C 7C002850 */  subf    r0, r0, r5
/* 0B80C0 800BD660 54009B7E */  srwi    r0, r0, 0xd
/* 0B80C4 800BD664 7C8301D6 */  mullw   r4, r3, r0
/* 0B80C8 800BD668 38C50000 */  addi    r6, r5, 0
/* 0B80CC 800BD66C 387F0000 */  addi    r3, r31, 0
/* 0B80D0 800BD670 38A02000 */  li      r5, 0x2000
/* 0B80D4 800BD674 4BFFFE49 */  bl      __CARDWrite
/* 0B80D8 800BD678 7C7D1B79 */  or.     r29, r3, r3
/* 0B80DC 800BD67C 40800044 */  bge     lbl_800BD6C0
lbl_800BD680:
/* 0B80E0 800BD680 801E00D0 */  lwz     r0, 0xd0(r30)
/* 0B80E4 800BD684 28000000 */  cmplwi  r0, 0
/* 0B80E8 800BD688 40820010 */  bne     lbl_800BD698
/* 0B80EC 800BD68C 387E0000 */  addi    r3, r30, 0
/* 0B80F0 800BD690 389D0000 */  addi    r4, r29, 0
/* 0B80F4 800BD694 4BFFE6E1 */  bl      __CARDPutControlBlock
lbl_800BD698:
/* 0B80F8 800BD698 801E00D8 */  lwz     r0, 0xd8(r30)
/* 0B80FC 800BD69C 28000000 */  cmplwi  r0, 0
/* 0B8100 800BD6A0 7C0C0378 */  mr      r12, r0
/* 0B8104 800BD6A4 4182001C */  beq     lbl_800BD6C0
/* 0B8108 800BD6A8 38000000 */  li      r0, 0
/* 0B810C 800BD6AC 7D8803A6 */  mtlr    r12
/* 0B8110 800BD6B0 901E00D8 */  stw     r0, 0xd8(r30)
/* 0B8114 800BD6B4 387F0000 */  addi    r3, r31, 0
/* 0B8118 800BD6B8 389D0000 */  addi    r4, r29, 0
/* 0B811C 800BD6BC 4E800021 */  blrl    
lbl_800BD6C0:
/* 0B8120 800BD6C0 8001002C */  lwz     r0, 0x2c(r1)
/* 0B8124 800BD6C4 83E10024 */  lwz     r31, 0x24(r1)
/* 0B8128 800BD6C8 83C10020 */  lwz     r30, 0x20(r1)
/* 0B812C 800BD6CC 83A1001C */  lwz     r29, 0x1c(r1)
/* 0B8130 800BD6D0 38210028 */  addi    r1, r1, 0x28
/* 0B8134 800BD6D4 7C0803A6 */  mtlr    r0
/* 0B8138 800BD6D8 4E800020 */  blr     

glabel __CARDAllocBlock
/* 0B813C 800BD6DC 7C0802A6 */  mflr    r0
/* 0B8140 800BD6E0 1CE30110 */  mulli   r7, r3, 0x110
/* 0B8144 800BD6E4 90010004 */  stw     r0, 4(r1)
/* 0B8148 800BD6E8 9421FFE0 */  stwu    r1, -0x20(r1)
/* 0B814C 800BD6EC 3CC08013 */  lis     r6, __CARDBlock@ha
/* 0B8150 800BD6F0 380627D0 */  addi    r0, r6, __CARDBlock@l
/* 0B8154 800BD6F4 93E1001C */  stw     r31, 0x1c(r1)
/* 0B8158 800BD6F8 7D203A14 */  add     r9, r0, r7
/* 0B815C 800BD6FC 93C10018 */  stw     r30, 0x18(r1)
/* 0B8160 800BD700 80090000 */  lwz     r0, 0(r9)
/* 0B8164 800BD704 2C000000 */  cmpwi   r0, 0
/* 0B8168 800BD708 4082000C */  bne     lbl_800BD714
/* 0B816C 800BD70C 3860FFFD */  li      r3, -3
/* 0B8170 800BD710 480000CC */  b       lbl_800BD7DC
lbl_800BD714:
/* 0B8174 800BD714 81090088 */  lwz     r8, 0x88(r9)
/* 0B8178 800BD718 A0080006 */  lhz     r0, 6(r8)
/* 0B817C 800BD71C 7C002040 */  cmplw   r0, r4
/* 0B8180 800BD720 4080000C */  bge     lbl_800BD72C
/* 0B8184 800BD724 3860FFF7 */  li      r3, -9
/* 0B8188 800BD728 480000B4 */  b       lbl_800BD7DC
lbl_800BD72C:
/* 0B818C 800BD72C 7C040050 */  subf    r0, r4, r0
/* 0B8190 800BD730 B0080006 */  sth     r0, 6(r8)
/* 0B8194 800BD734 3CC00001 */  lis     r6, 1
/* 0B8198 800BD738 3986FFFF */  addi    r12, r6, -1
/* 0B819C 800BD73C A1680008 */  lhz     r11, 8(r8)
/* 0B81A0 800BD740 380C0000 */  addi    r0, r12, 0
/* 0B81A4 800BD744 3BC00000 */  li      r30, 0
/* 0B81A8 800BD748 4800007C */  b       lbl_800BD7C4
lbl_800BD74C:
/* 0B81AC 800BD74C A1490010 */  lhz     r10, 0x10(r9)
/* 0B81B0 800BD750 3BDE0001 */  addi    r30, r30, 1
/* 0B81B4 800BD754 57C6043E */  clrlwi  r6, r30, 0x10
/* 0B81B8 800BD758 38EAFFFB */  addi    r7, r10, -5
/* 0B81BC 800BD75C 7C073000 */  cmpw    r7, r6
/* 0B81C0 800BD760 4080000C */  bge     lbl_800BD76C
/* 0B81C4 800BD764 3860FFFA */  li      r3, -6
/* 0B81C8 800BD768 48000074 */  b       lbl_800BD7DC
lbl_800BD76C:
/* 0B81CC 800BD76C 396B0001 */  addi    r11, r11, 1
/* 0B81D0 800BD770 5566043E */  clrlwi  r6, r11, 0x10
/* 0B81D4 800BD774 28060005 */  cmplwi  r6, 5
/* 0B81D8 800BD778 4180000C */  blt     lbl_800BD784
/* 0B81DC 800BD77C 7C065040 */  cmplw   r6, r10
/* 0B81E0 800BD780 41800008 */  blt     lbl_800BD788
lbl_800BD784:
/* 0B81E4 800BD784 39600005 */  li      r11, 5
lbl_800BD788:
/* 0B81E8 800BD788 55660BFC */  rlwinm  r6, r11, 1, 0xf, 0x1e
/* 0B81EC 800BD78C 7CE83214 */  add     r7, r8, r6
/* 0B81F0 800BD790 A0C70000 */  lhz     r6, 0(r7)
/* 0B81F4 800BD794 28060000 */  cmplwi  r6, 0
/* 0B81F8 800BD798 4082002C */  bne     lbl_800BD7C4
/* 0B81FC 800BD79C 5586043E */  clrlwi  r6, r12, 0x10
/* 0B8200 800BD7A0 2806FFFF */  cmplwi  r6, 0xffff
/* 0B8204 800BD7A4 4082000C */  bne     lbl_800BD7B0
/* 0B8208 800BD7A8 7D6C5B78 */  mr      r12, r11
/* 0B820C 800BD7AC 4800000C */  b       lbl_800BD7B8
lbl_800BD7B0:
/* 0B8210 800BD7B0 57E60BFC */  rlwinm  r6, r31, 1, 0xf, 0x1e
/* 0B8214 800BD7B4 7D68332E */  sthx    r11, r8, r6
lbl_800BD7B8:
/* 0B8218 800BD7B8 B0070000 */  sth     r0, 0(r7)
/* 0B821C 800BD7BC 3BEB0000 */  addi    r31, r11, 0
/* 0B8220 800BD7C0 3884FFFF */  addi    r4, r4, -1
lbl_800BD7C4:
/* 0B8224 800BD7C4 28040000 */  cmplwi  r4, 0
/* 0B8228 800BD7C8 4082FF84 */  bne     lbl_800BD74C
/* 0B822C 800BD7CC B1680008 */  sth     r11, 8(r8)
/* 0B8230 800BD7D0 7D044378 */  mr      r4, r8
/* 0B8234 800BD7D4 B18900BE */  sth     r12, 0xbe(r9)
/* 0B8238 800BD7D8 480000B9 */  bl      __CARDUpdateFatBlock
lbl_800BD7DC:
/* 0B823C 800BD7DC 80010024 */  lwz     r0, 0x24(r1)
/* 0B8240 800BD7E0 83E1001C */  lwz     r31, 0x1c(r1)
/* 0B8244 800BD7E4 83C10018 */  lwz     r30, 0x18(r1)
/* 0B8248 800BD7E8 38210020 */  addi    r1, r1, 0x20
/* 0B824C 800BD7EC 7C0803A6 */  mtlr    r0
/* 0B8250 800BD7F0 4E800020 */  blr     

glabel __CARDFreeBlock
/* 0B8254 800BD7F4 7C0802A6 */  mflr    r0
/* 0B8258 800BD7F8 1CE30110 */  mulli   r7, r3, 0x110
/* 0B825C 800BD7FC 90010004 */  stw     r0, 4(r1)
/* 0B8260 800BD800 3CC08013 */  lis     r6, __CARDBlock@ha
/* 0B8264 800BD804 9421FFF8 */  stwu    r1, -8(r1)
/* 0B8268 800BD808 380627D0 */  addi    r0, r6, __CARDBlock@l
/* 0B826C 800BD80C 7D203A14 */  add     r9, r0, r7
/* 0B8270 800BD810 80090000 */  lwz     r0, 0(r9)
/* 0B8274 800BD814 2C000000 */  cmpwi   r0, 0
/* 0B8278 800BD818 4082000C */  bne     lbl_800BD824
/* 0B827C 800BD81C 3860FFFD */  li      r3, -3
/* 0B8280 800BD820 48000060 */  b       lbl_800BD880
lbl_800BD824:
/* 0B8284 800BD824 81090088 */  lwz     r8, 0x88(r9)
/* 0B8288 800BD828 38E00000 */  li      r7, 0
/* 0B828C 800BD82C 48000040 */  b       lbl_800BD86C
lbl_800BD830:
/* 0B8290 800BD830 5484043E */  clrlwi  r4, r4, 0x10
/* 0B8294 800BD834 28040005 */  cmplwi  r4, 5
/* 0B8298 800BD838 41800010 */  blt     lbl_800BD848
/* 0B829C 800BD83C A0090010 */  lhz     r0, 0x10(r9)
/* 0B82A0 800BD840 7C040040 */  cmplw   r4, r0
/* 0B82A4 800BD844 4180000C */  blt     lbl_800BD850
lbl_800BD848:
/* 0B82A8 800BD848 3860FFFA */  li      r3, -6
/* 0B82AC 800BD84C 48000034 */  b       lbl_800BD880
lbl_800BD850:
/* 0B82B0 800BD850 5480083C */  slwi    r0, r4, 1
/* 0B82B4 800BD854 7CC80214 */  add     r6, r8, r0
/* 0B82B8 800BD858 A0860000 */  lhz     r4, 0(r6)
/* 0B82BC 800BD85C B0E60000 */  sth     r7, 0(r6)
/* 0B82C0 800BD860 A0C80006 */  lhz     r6, 6(r8)
/* 0B82C4 800BD864 38060001 */  addi    r0, r6, 1
/* 0B82C8 800BD868 B0080006 */  sth     r0, 6(r8)
lbl_800BD86C:
/* 0B82CC 800BD86C 5480043E */  clrlwi  r0, r4, 0x10
/* 0B82D0 800BD870 2800FFFF */  cmplwi  r0, 0xffff
/* 0B82D4 800BD874 4082FFBC */  bne     lbl_800BD830
/* 0B82D8 800BD878 7D044378 */  mr      r4, r8
/* 0B82DC 800BD87C 48000015 */  bl      __CARDUpdateFatBlock
lbl_800BD880:
/* 0B82E0 800BD880 8001000C */  lwz     r0, 0xc(r1)
/* 0B82E4 800BD884 38210008 */  addi    r1, r1, 8
/* 0B82E8 800BD888 7C0803A6 */  mtlr    r0
/* 0B82EC 800BD88C 4E800020 */  blr     

glabel __CARDUpdateFatBlock
/* 0B82F0 800BD890 7C0802A6 */  mflr    r0
/* 0B82F4 800BD894 90010004 */  stw     r0, 4(r1)
/* 0B82F8 800BD898 9421FFD8 */  stwu    r1, -0x28(r1)
/* 0B82FC 800BD89C 93E10024 */  stw     r31, 0x24(r1)
/* 0B8300 800BD8A0 93C10020 */  stw     r30, 0x20(r1)
/* 0B8304 800BD8A4 3BC50000 */  addi    r30, r5, 0
/* 0B8308 800BD8A8 93A1001C */  stw     r29, 0x1c(r1)
/* 0B830C 800BD8AC 3BA40000 */  addi    r29, r4, 0
/* 0B8310 800BD8B0 38BD0000 */  addi    r5, r29, 0
/* 0B8314 800BD8B4 93810018 */  stw     r28, 0x18(r1)
/* 0B8318 800BD8B8 3B830000 */  addi    r28, r3, 0
/* 0B831C 800BD8BC 38DD0002 */  addi    r6, r29, 2
/* 0B8320 800BD8C0 A0640004 */  lhz     r3, 4(r4)
/* 0B8324 800BD8C4 1C9C0110 */  mulli   r4, r28, 0x110
/* 0B8328 800BD8C8 38030001 */  addi    r0, r3, 1
/* 0B832C 800BD8CC 3C608013 */  lis     r3, __CARDBlock@ha
/* 0B8330 800BD8D0 B01D0004 */  sth     r0, 4(r29)
/* 0B8334 800BD8D4 380327D0 */  addi    r0, r3, __CARDBlock@l
/* 0B8338 800BD8D8 7FE02214 */  add     r31, r0, r4
/* 0B833C 800BD8DC 387D0004 */  addi    r3, r29, 4
/* 0B8340 800BD8E0 38801FFC */  li      r4, 0x1ffc
/* 0B8344 800BD8E4 480002BD */  bl      __CARDCheckSum
/* 0B8348 800BD8E8 387D0000 */  addi    r3, r29, 0
/* 0B834C 800BD8EC 38802000 */  li      r4, 0x2000
/* 0B8350 800BD8F0 4BFDFEBD */  bl      DCStoreRange
/* 0B8354 800BD8F4 93DF00D8 */  stw     r30, 0xd8(r31)
/* 0B8358 800BD8F8 3C60800C */  lis     r3, EraseCallback@ha
/* 0B835C 800BD8FC 38A3D614 */  addi    r5, r3, EraseCallback@l
/* 0B8360 800BD900 801F0080 */  lwz     r0, 0x80(r31)
/* 0B8364 800BD904 7F83E378 */  mr      r3, r28
/* 0B8368 800BD908 809F000C */  lwz     r4, 0xc(r31)
/* 0B836C 800BD90C 7C00E850 */  subf    r0, r0, r29
/* 0B8370 800BD910 54009B7E */  srwi    r0, r0, 0xd
/* 0B8374 800BD914 7C8401D6 */  mullw   r4, r4, r0
/* 0B8378 800BD918 4BFFE1D9 */  bl      __CARDEraseSector
/* 0B837C 800BD91C 8001002C */  lwz     r0, 0x2c(r1)
/* 0B8380 800BD920 83E10024 */  lwz     r31, 0x24(r1)
/* 0B8384 800BD924 83C10020 */  lwz     r30, 0x20(r1)
/* 0B8388 800BD928 83A1001C */  lwz     r29, 0x1c(r1)
/* 0B838C 800BD92C 83810018 */  lwz     r28, 0x18(r1)
/* 0B8390 800BD930 38210028 */  addi    r1, r1, 0x28
/* 0B8394 800BD934 7C0803A6 */  mtlr    r0
/* 0B8398 800BD938 4E800020 */  blr     


